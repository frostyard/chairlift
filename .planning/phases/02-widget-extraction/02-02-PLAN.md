---
phase: 02-widget-extraction
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - internal/widgets/action_button.go
  - internal/widgets/loading_row.go
  - internal/widgets/rows.go
autonomous: true

must_haves:
  truths:
    - "ActionButton exists and disables itself during operation"
    - "ActionButton shows working state during operation"
    - "LoadingRow exists and displays spinner with title/subtitle"
    - "Row builder functions create common ActionRow patterns"
  artifacts:
    - path: "internal/widgets/action_button.go"
      provides: "Self-disabling action button widget"
      exports: ["ActionButton", "NewActionButton", "NewActionButtonWithClass"]
      min_lines: 40
    - path: "internal/widgets/loading_row.go"
      provides: "Loading state row with spinner"
      exports: ["LoadingRow", "NewLoadingRow"]
      min_lines: 25
    - path: "internal/widgets/rows.go"
      provides: "ActionRow builder helpers"
      exports: ["NewLinkRow", "NewInfoRow", "NewButtonRow", "NewIconRow"]
      min_lines: 50
  key_links:
    - from: "internal/widgets/action_button.go"
      to: "github.com/jwijenbergh/puregotk/v4/gtk"
      via: "import for Button widget"
      pattern: "gtk\\.NewButtonWithLabel"
    - from: "internal/widgets/loading_row.go"
      to: "github.com/jwijenbergh/puregotk/v4/gtk"
      via: "import for Spinner widget"
      pattern: "gtk\\.NewSpinner"
---

<objective>
Create ActionButton, LoadingRow, and row builder widgets.

Purpose: Extract three more reusable widget patterns - self-disabling action buttons (ARCH-03), loading state rows (ARCH-04), and common ActionRow builders (ARCH-05).

Output: internal/widgets/action_button.go, internal/widgets/loading_row.go, internal/widgets/rows.go
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-widget-extraction/02-RESEARCH.md

# Prior plan created the package
@internal/widgets/doc.go
@internal/widgets/async_expander.go

# Reference for patterns being extracted
@internal/views/userhome.go (lines 462-523 for button pattern, 355-362 for loading row, 280-300 for row builders)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActionButton widget</name>
  <files>internal/widgets/action_button.go</files>
  <action>
Create internal/widgets/action_button.go implementing ActionButton based on RESEARCH.md Pattern 2.

The ActionButton struct should contain:
- Button *gtk.Button - the underlying widget
- originalLabel string - stored to restore after operation

Implement these functions and methods:

1. NewActionButton(label string) *ActionButton
   - Creates Button with label
   - Sets AlignCenter for vertical alignment
   - Stores originalLabel
   - Returns wrapper struct

2. NewActionButtonWithClass(label, cssClass string) *ActionButton
   - Calls NewActionButton
   - Adds CSS class (e.g., "suggested-action", "destructive-action")
   - Returns wrapper struct

3. StartOperation(workingLabel string) (done func())
   - Sets button insensitive (disabled)
   - Sets button label to workingLabel
   - Returns done func that:
     - Sets button sensitive (enabled)
     - Restores originalLabel

4. OnClicked(handler func(done func()))
   - Connects click handler to button
   - Handler receives done callback from StartOperation("Working...")
   - Pattern: button disables on click, handler calls done() when complete

Document that all methods must be called from main thread. The handler should use goroutines and async.RunOnMain() for async work.
  </action>
  <verify>
`go build ./internal/widgets/...` succeeds
`grep -l "type ActionButton struct" internal/widgets/action_button.go`
  </verify>
  <done>
ActionButton type exists with NewActionButton, NewActionButtonWithClass, StartOperation, OnClicked
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LoadingRow widget</name>
  <files>internal/widgets/loading_row.go</files>
  <action>
Create internal/widgets/loading_row.go implementing LoadingRow based on RESEARCH.md Pattern 4.

The LoadingRow struct should contain:
- Row *adw.ActionRow - the underlying widget
- Spinner *gtk.Spinner - the spinner widget

Implement these functions and methods:

1. NewLoadingRow(title, subtitle string) *LoadingRow
   - Creates ActionRow with title and subtitle
   - Creates Spinner
   - Starts spinner
   - Adds spinner as prefix to row
   - Returns wrapper struct

2. Stop()
   - Stops the spinner
   - Note: Does NOT remove row from parent - caller handles that

Document that creation and Stop() must be called from main thread.
  </action>
  <verify>
`go build ./internal/widgets/...` succeeds
`grep -l "type LoadingRow struct" internal/widgets/loading_row.go`
  </verify>
  <done>
LoadingRow type exists with NewLoadingRow and Stop methods
  </done>
</task>

<task type="auto">
  <name>Task 3: Create row builder helpers</name>
  <files>internal/widgets/rows.go</files>
  <action>
Create internal/widgets/rows.go implementing row builder functions based on RESEARCH.md Pattern 3.

Implement these factory functions:

1. NewLinkRow(title, subtitle string, onClick func()) *adw.ActionRow
   - Creates ActionRow with title and subtitle
   - Sets Activatable to true
   - Adds adw-external-link-symbolic icon as suffix
   - Connects Activated signal to onClick callback
   - Returns the ActionRow (not wrapped - simple factory)

2. NewInfoRow(title, subtitle string) *adw.ActionRow
   - Creates ActionRow with title and subtitle
   - Returns the ActionRow

3. NewButtonRow(title, subtitle, buttonLabel string, onClick func()) *adw.ActionRow
   - Creates ActionRow with title and subtitle
   - Creates Button with buttonLabel
   - Sets button AlignCenter vertically
   - Adds "suggested-action" CSS class to button
   - Connects Clicked signal to onClick callback
   - Adds button as suffix
   - Returns the ActionRow

4. NewButtonRowWithClass(title, subtitle, buttonLabel, cssClass string, onClick func()) *adw.ActionRow
   - Same as NewButtonRow but uses provided cssClass instead of "suggested-action"

5. NewIconRow(title, subtitle, iconName string) *adw.ActionRow
   - Creates ActionRow with title and subtitle
   - Creates Image from iconName
   - Adds image as prefix
   - Returns the ActionRow

Document that these are simple factory functions - the caller is responsible for adding them to groups/expanders.
  </action>
  <verify>
`go build ./internal/widgets/...` succeeds
`grep -l "func NewLinkRow" internal/widgets/rows.go`
`grep -l "func NewInfoRow" internal/widgets/rows.go`
`grep -l "func NewButtonRow" internal/widgets/rows.go`
`grep -l "func NewIconRow" internal/widgets/rows.go`
  </verify>
  <done>
NewLinkRow, NewInfoRow, NewButtonRow, NewButtonRowWithClass, NewIconRow functions exist
  </done>
</task>

</tasks>

<verification>
```bash
# Package compiles
go build ./internal/widgets/...

# No vet issues  
go vet ./internal/widgets/...

# Verify all exports exist
grep -l "type ActionButton struct" internal/widgets/action_button.go
grep -l "type LoadingRow struct" internal/widgets/loading_row.go
grep -l "func NewLinkRow" internal/widgets/rows.go
```
</verification>

<success_criteria>
- ActionButton type with NewActionButton, NewActionButtonWithClass, StartOperation, OnClicked
- LoadingRow type with NewLoadingRow and Stop
- NewLinkRow, NewInfoRow, NewButtonRow, NewButtonRowWithClass, NewIconRow factory functions
- All files compile without errors
- go vet passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-widget-extraction/02-02-SUMMARY.md`
</output>
