---
phase: 06.1-remove-instex
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/instex/ (DELETE)
  - internal/pages/extensions/page.go
  - internal/app/app.go
  - data/org.frostyard.ChairLift.instex.policy (DELETE)
  - data/org.frostyard.ChairLift.instex.rules (DELETE)
  - .goreleaser.yaml
  - CONFIG.md
autonomous: true

must_haves:
  truths:
    - "Application compiles without instex package"
    - "Extensions page loads without discover group UI"
    - "No references to 'instex' remain in Go source files"
    - "PolicyKit files for instex are deleted"
    - "goreleaser doesn't reference instex policies"
  artifacts:
    - path: "internal/pages/extensions/page.go"
      provides: "Extensions page without discover functionality"
      not_contains: "instex"
    - path: "internal/app/app.go"
      provides: "App initialization without instex"
      not_contains: "instex"
  key_links:
    - from: "extensions/page.go"
      to: "updex library"
      via: "client.ListInstalled"
      pattern: "p\\.client\\.ListInstalled"
---

<objective>
Remove the instex CLI dependency entirely from the codebase.

Purpose: instex is an external CLI tool for discovering/installing sysext extensions. The discover/install functionality is being removed to simplify the application. The installed extensions list remains (uses updex library).

Output: Clean codebase with no instex references, extensions page shows only installed extensions.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@internal/instex/instex.go
@internal/pages/extensions/page.go
@internal/app/app.go
@.goreleaser.yaml
@CONFIG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete instex package and PolicyKit files</name>
  <files>
    internal/instex/ (DELETE entire directory)
    data/org.frostyard.ChairLift.instex.policy (DELETE)
    data/org.frostyard.ChairLift.instex.rules (DELETE)
  </files>
  <action>
    Delete the instex package directory and its PolicyKit files:

    1. Delete `internal/instex/` directory (169-line instex.go file)
    2. Delete `data/org.frostyard.ChairLift.instex.policy`
    3. Delete `data/org.frostyard.ChairLift.instex.rules`

    Use `rm -rf` for the directory, `rm` for the individual files.
  </action>
  <verify>
    ```bash
    # Verify deletions
    ls internal/instex/ 2>&1 | grep -q "No such file"
    ls data/org.frostyard.ChairLift.instex.* 2>&1 | grep -q "No such file"
    ```
  </verify>
  <done>instex package and PolicyKit files no longer exist on disk</done>
</task>

<task type="auto">
  <name>Task 2: Remove instex references from source files</name>
  <files>
    internal/pages/extensions/page.go
    internal/app/app.go
    .goreleaser.yaml
    CONFIG.md
  </files>
  <action>
    Remove all instex references from source files:

    **internal/pages/extensions/page.go:**
    - Remove import: `"github.com/frostyard/chairlift/internal/instex"` (line 10)
    - Remove struct fields: `discoverEntry`, `discoverResultsGroup`, `discoverResultRows` (lines 24-27)
    - Remove call to `p.buildDiscoverGroup()` from `buildUI()` (line 86)
    - Delete method `buildDiscoverGroup()` (lines 196-238)
    - Delete method `onDiscoverClicked()` (lines 240-283)
    - Delete method `displayDiscoveryResults()` (lines 285-343)
    - Delete method `onInstallExtensionClicked()` (lines 345-405)

    **internal/app/app.go:**
    - Remove import: `"github.com/frostyard/chairlift/internal/instex"` (line 8)
    - Remove line: `instex.SetDryRun(true)` (line 43)

    **.goreleaser.yaml:**
    - Remove lines 122-126 (instex PolicyKit entries):
      ```yaml
      # PolicyKit policy and rules for instex
      - src: ./data/org.frostyard.ChairLift.instex.policy
        dst: /usr/share/polkit-1/actions/org.frostyard.ChairLift.instex.policy
      - src: ./data/org.frostyard.ChairLift.instex.rules
        dst: /usr/share/polkit-1/rules.d/org.frostyard.ChairLift.instex.rules
      ```

    **CONFIG.md:**
    - Remove line 69: `- \`discover_group\`: Discover and install extensions from remote repositories (requires \`instex\` command)`
  </action>
  <verify>
    ```bash
    # Verify no instex references remain in Go files
    grep -r "instex" internal/ --include="*.go" && echo "FAIL: instex still referenced" || echo "PASS: no instex references"

    # Verify build succeeds
    go build ./...

    # Verify goreleaser config is valid
    grep -q "instex" .goreleaser.yaml && echo "FAIL: instex in goreleaser" || echo "PASS: goreleaser clean"

    # Verify CONFIG.md updated
    grep -q "discover_group" CONFIG.md && echo "FAIL: discover_group in docs" || echo "PASS: docs clean"
    ```
  </verify>
  <done>
    - No "instex" imports in any Go file
    - `go build ./...` succeeds
    - goreleaser.yaml has no instex entries
    - CONFIG.md has no discover_group documentation
  </done>
</task>

</tasks>

<verification>
```bash
# Full verification suite
set -e

# 1. No instex directory
[ ! -d internal/instex ] && echo "PASS: instex directory deleted"

# 2. No instex PolicyKit files
[ ! -f data/org.frostyard.ChairLift.instex.policy ] && echo "PASS: instex policy deleted"
[ ! -f data/org.frostyard.ChairLift.instex.rules ] && echo "PASS: instex rules deleted"

# 3. No instex in Go source
! grep -rq "instex" internal/ --include="*.go" && echo "PASS: no instex in Go source"

# 4. Build succeeds
go build ./... && echo "PASS: build succeeds"

# 5. No instex in goreleaser
! grep -q "instex" .goreleaser.yaml && echo "PASS: goreleaser clean"

# 6. No discover_group in docs
! grep -q "discover_group" CONFIG.md && echo "PASS: docs clean"

echo "All verifications passed"
```
</verification>

<success_criteria>
1. Application compiles without instex package
2. Extensions page loads and shows installed extensions (no discover UI)
3. Zero references to "instex" in any Go source file
4. instex PolicyKit files deleted from data/
5. goreleaser.yaml doesn't reference instex policies
6. CONFIG.md doesn't document discover_group
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-remove-instex/06.1-01-SUMMARY.md`
</output>
