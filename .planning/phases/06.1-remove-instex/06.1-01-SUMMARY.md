---
phase: 06.1-remove-instex
plan: 01
subsystem: extensions
tags: [instex, updex, sysext, polkit, cleanup]

# Dependency graph
requires:
  - phase: 06
    provides: Extensions page with updex library integration for listing and Client wrapper
provides:
  - Extensions page uses updex SDK for all operations (discover, install)
  - Removed instex CLI dependency
  - Cleaned up PolicyKit files and goreleaser configuration
affects: [07-complex-pages, distribution-packaging]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Client.IsDiscoverAvailable() checks SDK availability

key-files:
  created: []
  modified:
    - internal/pages/extensions/logic.go
    - internal/pages/extensions/page.go
    - internal/app/app.go
    - .goreleaser.yaml
    - CONFIG.md

key-decisions:
  - "Use page context (p.ctx) for Discover/Install calls instead of creating new context"
  - "Check IsAvailable() for IsDiscoverAvailable() since updex SDK needs systemd-sysext"

patterns-established:
  - "Client methods wrap SDK calls for all extension operations"

# Metrics
duration: 2min
completed: 2026-01-27
---

# Phase 6.1 Plan 01: Remove instex Summary

**Extensions page migrated from instex CLI wrapper to updex SDK - zero references to instex remain in codebase**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-27T15:30:11Z
- **Completed:** 2026-01-27T15:32:13Z
- **Tasks:** 2
- **Files modified:** 6 (+ 4 deleted)

## Accomplishments

- Migrated extensions page to use Client.Discover() and Client.Install() instead of instex CLI
- Added IsDiscoverAvailable() method to Client for feature detection
- Deleted entire internal/instex package (169 lines)
- Removed instex PolicyKit files from data/ and .goreleaser.yaml
- Updated CONFIG.md documentation

## Task Commits

Each task was committed atomically:

1. **Task 1: Migrate page.go to use Client** - `01b8a82` (feat)
2. **Task 2: Delete instex package and clean up** - `7d4400c` (chore)

## Files Created/Modified

- `internal/pages/extensions/logic.go` - Added IsDiscoverAvailable() method
- `internal/pages/extensions/page.go` - Replaced all instex calls with p.client methods
- `internal/app/app.go` - Removed instex import and SetDryRun call
- `.goreleaser.yaml` - Removed instex PolicyKit packaging
- `CONFIG.md` - Removed instex requirement from discover_group docs

**Files Deleted:**
- `internal/instex/instex.go` - Complete CLI wrapper package
- `data/org.frostyard.ChairLift.instex.policy` - PolicyKit policy
- `data/org.frostyard.ChairLift.instex.rules` - PolicyKit rules

## Decisions Made

1. **Use p.ctx instead of new context** - The page already manages context lifecycle with cancel, so using p.ctx for Discover/Install maintains proper goroutine cleanup
2. **IsDiscoverAvailable checks IsAvailable()** - The updex SDK functionality requires systemd-sysext, which is the same check as IsAvailable()

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## Next Phase Readiness

- Phase 6.1 complete with this single plan
- Ready for Phase 7 (Complex Pages)
- Extensions page now fully integrated with updex SDK
- No external CLI dependencies for extension management

---
*Phase: 06.1-remove-instex*
*Completed: 2026-01-27*
