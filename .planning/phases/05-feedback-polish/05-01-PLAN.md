---
phase: 05-feedback-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/widgets/empty_state.go
  - internal/operations/popover.go
autonomous: true

must_haves:
  truths:
    - "Empty operations list shows StatusPage instead of dim label"
    - "Empty history list shows StatusPage instead of dim label"
    - "NewEmptyState helper creates properly configured AdwStatusPage"
  artifacts:
    - path: "internal/widgets/empty_state.go"
      provides: "NewEmptyState helper function"
      exports: ["NewEmptyState", "EmptyStateConfig"]
    - path: "internal/operations/popover.go"
      provides: "StatusPage for empty states in popover"
      contains: "NewEmptyState"
  key_links:
    - from: "internal/operations/popover.go"
      to: "internal/widgets/empty_state.go"
      via: "widgets.NewEmptyState call"
      pattern: "widgets\\.NewEmptyState"
---

<objective>
Create reusable empty state widget and upgrade operations popover to use proper StatusPage for empty lists.

Purpose: GNOME HIG-compliant empty states improve user experience with clear guidance text and icons instead of plain dim labels.
Output: NewEmptyState helper in widgets package, upgraded popover empty states.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-feedback-polish/05-RESEARCH.md

@internal/widgets/rows.go
@internal/operations/popover.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NewEmptyState widget helper</name>
  <files>internal/widgets/empty_state.go</files>
  <action>
Create a new file `internal/widgets/empty_state.go` with:

1. EmptyStateConfig struct with fields:
   - Title string
   - Description string
   - IconName string
   - Compact bool (for inline use in expanders/popovers)

2. NewEmptyState function that:
   - Creates adw.NewStatusPage()
   - Sets title, description, iconName from config
   - Adds "compact" CSS class if Compact is true
   - Returns *adw.StatusPage

Include package doc comment noting common icon names:
- "folder-symbolic" for empty file/folder lists
- "emblem-synchronizing-symbolic" for empty operations list
- "document-open-recent-symbolic" for empty history
- "package-x-generic-symbolic" for empty package lists

Follow existing widget patterns from rows.go for documentation style.
  </action>
  <verify>File exists with proper Go syntax: `go build ./internal/widgets/...`</verify>
  <done>NewEmptyState function exists and compiles, creates StatusPage with configurable title, description, icon, and compact mode</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade popover empty states to use StatusPage</name>
  <files>internal/operations/popover.go</files>
  <action>
Modify operations/popover.go to use widgets.NewEmptyState for empty states:

1. Add import for "github.com/frostyard/chairlift/internal/widgets"

2. In OperationsButton struct, change emptyLabel field from *gtk.Label to *adw.StatusPage

3. In buildPopoverContent() (around line 96-101):
   - Replace gtk.NewLabel("No active operations") with:
   ```go
   ob.emptyLabel = widgets.NewEmptyState(widgets.EmptyStateConfig{
       Title:       "No Active Operations",
       Description: "Operations will appear here when running",
       IconName:    "emblem-synchronizing-symbolic",
       Compact:     true,
   })
   ```
   - Adjust margins as needed (StatusPage has its own margins)

4. In refreshActiveList() (around line 186-193):
   - Change emptyLabel visibility to use SetVisible on StatusPage's Widget

5. In refreshHistoryList() (around line 314-319):
   - Replace the inline gtk.NewLabel for empty history with:
   ```go
   emptyState := widgets.NewEmptyState(widgets.EmptyStateConfig{
       Title:       "No Completed Operations",
       Description: "Completed operations will appear here",
       IconName:    "document-open-recent-symbolic",
       Compact:     true,
   })
   ob.historyList.Append(&emptyState.Widget)
   ```
  </action>
  <verify>Build succeeds: `go build ./...` and visually check that empty states show StatusPage not dim labels when running app</verify>
  <done>Operations popover shows StatusPage with icon and description for both empty active and empty history states</done>
</task>

</tasks>

<verification>
1. `go build ./...` succeeds with no errors
2. `go vet ./...` passes
3. Application runs without crash
4. Operations popover shows proper StatusPage when no active operations
5. History tab shows proper StatusPage when no completed operations
</verification>

<success_criteria>
- NewEmptyState helper exists and is documented
- Operations popover uses StatusPage for empty states (not dim labels)
- Empty states show icon, title, and description
- Compact mode works correctly for inline display
</success_criteria>

<output>
After completion, create `.planning/phases/05-feedback-polish/05-01-SUMMARY.md`
</output>
