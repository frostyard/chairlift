---
phase: 07-complex-pages
plan: 05
type: execute
wave: 3
depends_on: ["07-01", "07-02", "07-03", "07-04"]
files_modified:
  - internal/views/shell.go
  - internal/pages/updates/page.go
  - internal/pages/applications/page.go
autonomous: false

must_haves:
  truths:
    - "All existing functionality works identically to before refactoring"
    - "Update badge counts correctly from all sources"
    - "NBC updates work with progress display"
    - "Flatpak install/uninstall/update works"
    - "Homebrew update/upgrade/search/install works"
    - "Snap list displays correctly"
    - "Applications sidebar navigation works"
  artifacts:
    - path: "internal/views/shell.go"
      provides: "Final shell under 300 lines"
      max_lines: 300
  key_links:
    - from: "internal/views/shell.go"
      to: "pages.Page interface"
      via: "Widget() and Destroy() calls"
      pattern: "\\.(Widget|Destroy)\\(\\)"
---

<objective>
Verify all functionality works correctly and perform final integration fixes.

Purpose: After all page extractions, verify the complete system works identically to before. Fix any integration issues discovered during testing.

Output: Fully functional application with all pages extracted and shell under 300 lines.
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-complex-pages/07-CONTEXT.md
@.planning/phases/07-complex-pages/07-01-SUMMARY.md
@.planning/phases/07-complex-pages/07-02-SUMMARY.md
@.planning/phases/07-complex-pages/07-03-SUMMARY.md
@.planning/phases/07-complex-pages/07-04-SUMMARY.md

# Final shell and pages
@internal/views/shell.go
@internal/pages/updates/page.go
@internal/pages/applications/page.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full build and lint</name>
  <files></files>
  <action>
Run complete build and lint checks:

1. Run build:
   ```bash
   go build ./...
   ```

2. Run linter:
   ```bash
   make lint
   ```
   OR if make target doesn't exist:
   ```bash
   golangci-lint run ./...
   ```

3. Run any existing tests:
   ```bash
   go test ./...
   ```

4. Fix any issues found:
   - Unused imports
   - Unused variables
   - Lint warnings
   - Test failures

5. Verify line count:
   ```bash
   wc -l internal/views/shell.go
   ```
   Must be under 300 lines.
  </action>
  <verify>
`go build ./...` succeeds with no errors.
`make lint` or `golangci-lint run` passes.
`go test ./...` passes.
`wc -l internal/views/shell.go` is under 300.
  </verify>
  <done>Build, lint, and tests pass. Shell under 300 lines.</done>
</task>

<task type="auto">
  <name>Task 2: Fix any integration issues</name>
  <files>internal/views/shell.go, internal/pages/updates/page.go, internal/pages/applications/page.go</files>
  <action>
Fix integration issues discovered during testing:

1. Start the application:
   ```bash
   go run ./cmd/chairlift/
   ```

2. Test each page:
   - System: NBC status loads, system info displays
   - Updates: NBC check works, Flatpak updates load, Homebrew update button works
   - Applications: Sidebar navigation works, all PM sections load
   - Maintenance: Actions work
   - Extensions: Discovery works
   - Help: Links work

3. Test operations integration:
   - Homebrew Update shows in operations popover
   - Retry works for failed operations

4. Test badge count:
   - Updates badge in sidebar reflects available updates
   - Badge updates when checking for updates

5. Fix any issues found:
   - Missing callback wiring
   - Incorrect context usage
   - UI not updating
   - Toast not showing

Common issues to check:
- Badge callback not wired (onBadgeUpdate)
- Context cancellation not checked before UI update
- Missing operations.Start() for long operations
- Closure variable capture in loops
  </action>
  <verify>
Application starts without errors.
All pages navigate correctly.
All functionality works as before.
  </verify>
  <done>All integration issues fixed, functionality verified.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: User verification of complete functionality</name>
  <what-built>
Complete page extraction for Phase 7:
- Updates page extracted to internal/pages/updates/
- Applications page extracted to internal/pages/applications/
- shell.go reduced to under 300 lines (from 1811 line userhome.go)
- All 6 pages now use page packages with proper lifecycle
  </what-built>
  <how-to-verify>
1. Start the application: `go run ./cmd/chairlift/`

2. Test Updates page:
   - Navigate to Updates
   - Click "Check" for NBC updates (if NBC available)
   - Verify Flatpak updates section loads
   - Click "Update" on Homebrew - verify it shows in operations popover
   - Verify update badge in sidebar reflects available updates

3. Test Applications page:
   - Navigate to Applications
   - Verify sidebar shows PM categories (All, Flatpak, Homebrew, Snap)
   - Click each sidebar item - content should switch
   - Verify Flatpak apps list with uninstall buttons
   - Verify Homebrew formulae and casks display
   - Test Homebrew search - enter query, verify results
   - Click Install on search result - verify operation works

4. Test other pages still work:
   - System page loads NBC status
   - Maintenance page actions work
   - Extensions page discovery works
   - Help page links work

5. Verify shell.go is under 300 lines:
   `wc -l internal/views/shell.go`

6. Final check: All functionality works identically to before refactoring
  </how-to-verify>
  <resume-signal>Type "approved" if all functionality works, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. `go build ./...` - No errors
2. `make lint` or equivalent - Passes
3. `go test ./...` - All tests pass
4. `wc -l internal/views/shell.go` - Under 300 lines
5. Manual testing of all pages - All functionality works
6. Update badge works correctly
7. Operations popover shows long-running operations
</verification>

<success_criteria>
- All pages extracted and working
- shell.go under 300 lines
- All original functionality preserved
- Badge count works correctly
- Build/lint/tests pass
- User verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/07-complex-pages/07-05-SUMMARY.md`
</output>
