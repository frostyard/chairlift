---
phase: 09-testing-library
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - pkg/adwutil/widgets.go
  - pkg/adwutil/examples/basic/main.go
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Basic example shows button with warning icon that triggers toast"
    - "NewButtonRowWithIcon helper exists in adwutil"
  artifacts:
    - path: "pkg/adwutil/widgets.go"
      provides: "NewButtonRowWithIcon helper"
      contains: "NewButtonRowWithIcon"
    - path: "pkg/adwutil/examples/basic/main.go"
      provides: "Warning button demo with toast"
      contains: "toast"
  key_links:
    - from: "pkg/adwutil/examples/basic/main.go"
      to: "pkg/adwutil/widgets.go"
      via: "adwutil.NewButtonRowWithIcon call"
      pattern: "NewButtonRowWithIcon"
---

<objective>
Add warning button with toast demonstration to basic example

Purpose: Close UAT gap - basic example should demonstrate button with warning icon suffix that triggers a toast notification when clicked.
Output: Updated basic example with toast overlay and warning button demo
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@pkg/adwutil/widgets.go
@pkg/adwutil/examples/basic/main.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add NewButtonRowWithIcon helper to adwutil</name>
  <files>pkg/adwutil/widgets.go</files>
  <action>
Add a new helper function `NewButtonRowWithIcon` that creates an ActionRow with:
- Title and subtitle as usual
- A button with a label (like existing NewButtonRow)
- An icon suffix BEFORE the button (using gtk.NewImageFromIconName)
- onClick callback

Function signature:
```go
func NewButtonRowWithIcon(title, subtitle, buttonLabel, iconName string, onClick func()) *adw.ActionRow
```

The icon should be positioned as a suffix before the button, so visual order is: [Title/Subtitle] ... [Icon] [Button]

Use the same callback storage pattern as other helpers to prevent GC collection.

Also add a convenience wrapper `NewButtonRowWarning` that uses "dialog-warning-symbolic" icon and "destructive-action" button style:
```go
func NewButtonRowWarning(title, subtitle, buttonLabel string, onClick func()) *adw.ActionRow
```
  </action>
  <verify>
Verify pkg/adwutil/widgets.go contains NewButtonRowWithIcon and NewButtonRowWarning functions:
- `grep -n "NewButtonRowWithIcon" pkg/adwutil/widgets.go`
- `grep -n "NewButtonRowWarning" pkg/adwutil/widgets.go`
- `go build ./pkg/adwutil/...` succeeds
  </verify>
  <done>NewButtonRowWithIcon and NewButtonRowWarning helpers exist and compile</done>
</task>

<task type="auto">
  <name>Task 2: Add toast and warning button demo to basic example</name>
  <files>pkg/adwutil/examples/basic/main.go</files>
  <action>
Update the basic example to demonstrate the warning button with toast:

1. Add an adw.ToastOverlay wrapping the scrolled content:
   - Create toast overlay: `toastOverlay := adw.NewToastOverlay()`
   - Set scrolled window as child: `toastOverlay.SetChild(&scrolled.Widget)`
   - Use toast overlay as content instead of scrolled: `toolbarView.SetContent(&toastOverlay.Widget)`

2. Add a new preferences group "Warning Actions" after the existing groups with:
   - Use `adwutil.NewButtonRowWarning` to create a row:
     - Title: "Clear Cache"
     - Subtitle: "Remove temporary files (this action cannot be undone)"
     - Button label: "Clear"
     - onClick: Show a toast via toastOverlay.AddToast()

3. Toast should display: "Cache cleared successfully" using adw.NewToast()

Important: The toastOverlay variable needs to be accessible in the onClick callback. Either:
- Declare toastOverlay early in activate() before defining onClick, or
- Use a closure that captures toastOverlay

This demonstrates:
- Icon suffix on button rows (warning icon)
- Destructive action button styling
- Toast notification feedback pattern
  </action>
  <verify>
- `go build ./pkg/adwutil/examples/basic` succeeds
- `grep -n "ToastOverlay" pkg/adwutil/examples/basic/main.go` shows toast overlay creation
- `grep -n "NewButtonRowWarning\|dialog-warning" pkg/adwutil/examples/basic/main.go` shows warning button
- `grep -n "Cache cleared" pkg/adwutil/examples/basic/main.go` shows toast message
  </verify>
  <done>Basic example has warning button with toast notification demo</done>
</task>

</tasks>

<verification>
- `go build ./pkg/adwutil/...` - library compiles
- `go build ./pkg/adwutil/examples/basic` - example compiles
- `grep "NewButtonRowWithIcon\|NewButtonRowWarning" pkg/adwutil/widgets.go` - helpers exist
- `grep "ToastOverlay\|warning" pkg/adwutil/examples/basic/main.go` - toast and warning demo present
</verification>

<success_criteria>
- NewButtonRowWithIcon helper added to adwutil widgets
- NewButtonRowWarning convenience wrapper added
- Basic example includes toast overlay
- Basic example has warning button that triggers toast when clicked
- All code compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-testing-library/09-06-SUMMARY.md`
</output>
