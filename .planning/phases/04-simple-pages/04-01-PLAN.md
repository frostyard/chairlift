---
phase: 04-simple-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/pages/page.go
  - internal/pages/help/page.go
  - internal/pages/help/logic.go
autonomous: true

must_haves:
  truths:
    - "Help page builds and displays help links from config"
    - "Page interface exists for all pages to implement"
    - "Help page logic is testable without GTK runtime"
  artifacts:
    - path: "internal/pages/page.go"
      provides: "Page interface, Deps struct, Toaster interface"
      contains: "type Page interface"
    - path: "internal/pages/help/page.go"
      provides: "HelpPage struct with constructor and Widget() method"
      contains: "func New"
    - path: "internal/pages/help/logic.go"
      provides: "Pure Go logic for building resource links"
      contains: "func BuildResourceLinks"
  key_links:
    - from: "internal/pages/help/page.go"
      to: "internal/pages/page.go"
      via: "implements Page interface"
      pattern: "pages\\.Deps"
    - from: "internal/pages/help/page.go"
      to: "internal/pages/help/logic.go"
      via: "calls business logic"
      pattern: "BuildResourceLinks"
---

<objective>
Create the common page interface and implement the Help page package as the first extracted page.

Purpose: Establish the page interface pattern that all pages will follow, starting with the simplest page (Help) to validate the approach before tackling more complex pages.

Output: `internal/pages/page.go` with shared types, `internal/pages/help/` package with working Help page implementation.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-simple-pages/04-RESEARCH.md

@internal/views/userhome.go (lines 1192-1265 for buildHelpPage)
@internal/config/config.go
@internal/widgets/rows.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create page interface and shared types</name>
  <files>internal/pages/page.go</files>
  <action>
Create `internal/pages/page.go` with:

1. Package declaration and imports (adw, config)

2. `Toaster` interface matching the existing `ToastAdder` interface pattern:
   - `ShowToast(message string)`
   - `ShowErrorToast(message string)`
   - Do NOT include `SetUpdateBadge` - that's specific to window, not needed by pages

3. `Deps` struct for dependency injection:
   - `Config *config.Config`
   - `Toaster Toaster`

4. `Page` interface that all pages will implement:
   - `Widget() *adw.ToolbarView` - returns the root GTK widget for embedding
   - `Destroy()` - cleans up resources (cancels goroutines, removes callbacks)

5. Doc comment explaining the package purpose and page pattern

Reference the existing `ToastAdder` interface in userhome.go for method signatures.
  </action>
  <verify>
`go build ./internal/pages/...` succeeds
  </verify>
  <done>
`internal/pages/page.go` exists with Page interface, Deps struct, and Toaster interface
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Help page logic layer</name>
  <files>internal/pages/help/logic.go</files>
  <action>
Create `internal/pages/help/logic.go` with pure Go business logic:

1. Package declaration: `package help`

2. `ResourceLink` struct:
   - `Title string` - display title (e.g., "Website", "Report Issues")
   - `Subtitle string` - display subtitle (usually the URL)
   - `URL string` - the actual URL to open

3. `BuildResourceLinks(cfg *config.GroupConfig) []ResourceLink` function:
   - Takes a GroupConfig pointer (from config.GetGroupConfig)
   - Returns nil if cfg is nil
   - Checks cfg.Website, cfg.Issues, cfg.Chat fields
   - For each non-empty field, creates a ResourceLink with appropriate title:
     - Website: "Website", subtitle=url, url=cfg.Website
     - Issues: "Report Issues", subtitle=url, url=cfg.Issues  
     - Chat: "Community Discussions", subtitle=url, url=cfg.Chat
   - Returns the slice of links

This logic is pure Go with no GTK dependencies, making it testable.
  </action>
  <verify>
`go build ./internal/pages/help/...` succeeds
  </verify>
  <done>
`internal/pages/help/logic.go` exists with BuildResourceLinks function
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Help page UI layer</name>
  <files>internal/pages/help/page.go</files>
  <action>
Create `internal/pages/help/page.go` implementing the Page interface:

1. Package declaration and imports (adw, gtk, config, pages, widgets)

2. `Page` struct with fields:
   - `toolbarView *adw.ToolbarView` - root widget
   - `prefsPage *adw.PreferencesPage` - content container
   - `config *config.Config`
   - `toaster pages.Toaster`
   - `openURL func(string)` - callback for opening URLs

3. `New(deps pages.Deps, openURL func(string)) *Page` constructor:
   - Creates Page struct with deps
   - Calls `p.buildUI()`
   - Returns the page

4. `Widget() *adw.ToolbarView` method - returns toolbarView

5. `Destroy()` method - no-op for Help page (no goroutines to cancel)

6. `buildUI()` private method:
   - Creates ToolbarView with HeaderBar (same pattern as userhome.go createPage)
   - Creates ScrolledWindow with PreferencesPage
   - Calls `p.buildResourcesGroup()`

7. `buildResourcesGroup()` private method:
   - Check `p.config.IsGroupEnabled("help_page", "help_resources_group")`, return if disabled
   - Get group config via `p.config.GetGroupConfig("help_page", "help_resources_group")`
   - Create PreferencesGroup with title "Help &amp; Resources" and description
   - Call `BuildResourceLinks(groupCfg)` from logic.go
   - For each link, create `widgets.NewLinkRow(link.Title, link.Subtitle, func() { p.openURL(link.URL) })`
   - IMPORTANT: Capture link.URL in a local variable before the closure to avoid loop variable capture bug
   - Add each row to group, add group to prefsPage

Follow the exact patterns from userhome.go buildHelpPage (lines 1192-1265) but using the new structure.
  </action>
  <verify>
`go build ./internal/pages/help/...` succeeds
  </verify>
  <done>
`internal/pages/help/page.go` exists with Page struct implementing pages.Page interface
  </done>
</task>

</tasks>

<verification>
- [ ] `go build ./internal/pages/...` compiles successfully
- [ ] `internal/pages/page.go` defines Page interface with Widget() and Destroy()
- [ ] `internal/pages/page.go` defines Deps struct with Config and Toaster
- [ ] `internal/pages/help/logic.go` has BuildResourceLinks with no GTK imports
- [ ] `internal/pages/help/page.go` implements pages.Page interface
</verification>

<success_criteria>
- Help page package exists at `internal/pages/help/`
- Page interface established at `internal/pages/page.go`
- Help page builds without errors
- Business logic is separated from UI code
</success_criteria>

<output>
After completion, create `.planning/phases/04-simple-pages/04-01-SUMMARY.md`
</output>
